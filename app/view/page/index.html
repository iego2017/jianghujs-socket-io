{% extends 'template/duoxingTemplate.html'%}

<!-- vue template 代码块 -->
{% block vue_template %}
<v-app id="inspire">
<!-- 左边栏 -->
<LeftPanel ref="leftPanel"/>
<!-- 中间栏目 -->
<MiddlePanel ref="middlePanel" :currentChatSessionId="currentChatSessionId"/>
</v-app>
{% endblock %}

<!-- vue script 代码块 -->
<!-- 注意：本项目的 vue 为每个页面使用一个 vue 实例 -->
{% block vue_body %}
{% include 'components/impl/indexHandler.html' %}
{% include 'components/impl/socketHandler.html' %}
{% include 'components/impl/messageHandler.html' %}

{% include 'components/widget/leftUserWidget.html' %} {% include
'components/widget/leftChatSessionWidget.html' %} {% include
'components/widget/leftPanelWidget.html' %} {% include
'components/widget/middlePanelWidget.html' %} {% include
'components/widget/middleChatInputWidget.html' %} {% include
'components/widget/middleChatMessageWidget.html' %} {% include
'components/message/imageMessage.html' %} {% include
'components/message/fileMessage.html' %} {% include
'components/message/textMessage.html' %} {% include
'components/message/videoMessage.html' %} {% include
'components/message/voiceMessage.html' %} {% include
'components/common/clipboard.html' %} {% include
'components/common/emotion.html' %}

<script type="module">
window.registerData(
    {
      indexHandler: new IndexHandler(),
      socketHandler: new SocketHandler(),
      messageHandler: new MessageHandler(),
      messageTextareaValue: '',
      currentChatSessionId: null,
      chatListBackUps: [],
      myFriendList: [],
      myFriendListBackUps: [],
      userRoomRoleList: [],
      userRoomRoleListBackUps: [],
      botList: [],
      botListBackUps: [],
      searchUserUid: null,
      socketClient: window.socket,
      userInfo: {
        // Tip: 设置默认图片, 避免页面image初始化渲染异常
        userAvatar: '<$ ctx.app.config.duoxingConfig.defaultAvatar.user $>',
        userId: '<$ ctx.userInfo.userId $>'
      },
      draft: JSON.parse(localStorage.getItem('draft') || '{}'),
      dataSyncStatus: '',
      getDataId,
    },
    {
      socketStatus() {
        const label = ['连接成功', '连接中...', '连接断开'][this.isSocketOnline || 0];
        const color = ['green accent-3', 'amber darken-1', 'deep-orange accent-3'][this.isSocketOnline || 0];
        return {label, color};
      },
      chatList() {
        let list = this.chatListBackUps.slice();
        if (!_.isEmpty(this.searchKeyword)) {
          list = this.indexHandler.filterBySearchKeyword(list, this.searchKeyword);
        }

        if (!_.isEmpty(this.botList)) {
          list = this.indexHandler.filterByBotList(list, this.botList);
        }

        return list;
      },
      currentChatSession() {
        return this.chatListBackUps.slice().find(item => this.getDataId(item) === this.currentChatSessionId);
      }
    }
)

const didaAudio = new Audio(
    '/<$ ctx.app.config.appId $>/public/audio/dida.wav'
);
new Vue({
  el: '#app',
  template: '#app-template',
  vuetify: new Vuetify(),
  mixins: [window.jianghuUiActionMixins],
  data: () => window.vueData,
  vueComponent: 'root',
  computed: window.vueComputed,
  components: {},
  async created() {
    // 手机端，除了输入框，其他地方禁止系统菜单
    this.doUiAction('setSyncStatusToSyncing');
    this.doUiAction('disableSystemEvent');
    this.doUiAction('initWebSocket');
    this.doUiAction('initDefaultVariable');
    this.doUiAction('getConstantList');
    await this.doUiAction('getUserInfo');
    await this.doUiAction('setSyncStatusToSuccess');
    this.handlerSystemBack();
  },
  watch: {
    chatListBackUps: {
      deep: true,
      handler() {
      }
    },
    botList: {
      deep: true,
      handler() {
      }
    },
    mobileLeftHide(value) {
      window.mobileLeftHide = value;
    },
    async currentChatSessionId(v) {
      try {
        this.messageTextareaValue = v ? this.draft[v] : null;
      } catch (e) {
        this.messageTextareaValue = null;
      }
      this.$forceUpdate();
    }
  },
  methods: {
    handlerSystemBack() {
      history.pushState({}, '', `?chatList=${new Date().getTime()}`);
      window.addEventListener('popstate', () => {
        if (location.href.indexOf('/page/index?chatList=') > -1) {
          history.pushState({}, '', `?chatList=${new Date().getTime()}`);
        }
      });
    },
    initDefaultVariable() {
      this.doUiAction('pushState', {path: 'chatList'});
    },
    setSyncStatusToSyncing() {
      this.dataSyncStatus = 'syncing'
      window.sync = {
        ing: true
      };
    },
    setSyncStatusToSuccess() {
      this.dataSyncStatus = 'success'
      window.sync.ing = false;
    },
    // ✅禁止系统菜单和文字选中
    disableSystemEvent() {
      this.indexHandler.disableSystemEvent(this.isMobile);
    },
    /** 初始化socket */
    initWebSocket() {
      this.socketClient.init();
      this.socketClient.addListeners('reConnect', result => this.doUiAction('onSocketReConnect', result));
      this.socketClient.addListeners('userNotice', result => this.doUiAction('onUserNotice', result));
      this.socketClient.addListeners('userMessage', result => this.doUiAction('onUserMessage', result));
      this.socketClient.addListeners('roomNotice', result => this.doUiAction('onRoomNotice', result));
      this.socketClient.addListeners('roomMessage', result => this.doUiAction('onRoomMessage', result));
      this.socketClient.addListeners('toggleChatSession', result => this.doUiAction('onToggleChatSession', result));
      this.socketClient.addListeners('delMessageOffline', result => this.doUiAction('onDelMessageOffline', result));
      this.socketClient.addListeners('deleteChatSession', result => this.doUiAction('onDeleteChatSession', result));
    },
    async getConstantList() {
      this.indexHandler.syncAppLinkActionConfig()
    },
    async getUserInfo() {
      this.userInfo = await refreshUserInfo();
      this.userRoomRoleList = _.cloneDeep(global.userRoomRoleList);
      this.userRoomRoleListBackUps = _.cloneDeep(global.userRoomRoleList);
      if (this.isRoom && !this.userRoomRoleList.some(item => item.roomId === this.currentChatSessionId)) {
        this.currentChatSessionId = null;
      }
    },

    // 过滤和排序列表
    reFilterList() {
      // chatListBackUps 也要重排
      if (this.chatListBackUps) {
        this.chatListBackUps = this.indexHandler.sortChatListBackUps(this.chatListBackUps);
      }
    },
    preventDefault,
    /** 手动触发系统后退 */
    windowBack() {
      this.$nextTick(() => {
        if (isMobile) {
          window.history.back();
        }
      });
    },
    /**
     * 断线重连监听
     * @param hasDisconnectOrError
     * @param hasDisconnectOrError.hasError
     */
    async onSocketReConnect({hasError}) {
      console.log('断线重连监听:index', hasError)
      if (hasError) {
        this.doUiAction('setSyncStatusToSyncing')
        await this.doUiAction('getUserInfo');
        await this.doUiAction('getChatSessionList', {type: 'onSocketReConnect'});
        this.doUiAction('setSyncStatusToSuccess')
      }
    },


    onUserNotice(result) {
      this.renderChatSession(result);
      this.renderNoticeUI(result);
      this.handleNoticeMessage(result);
    },
    onRoomNotice(result) {
      this.renderChatSession(result);
      this.renderNoticeUI(result);
      this.handleNoticeMessage(result);
    },
    onUserMessage(result) {
      this.renderChatSession(result);
      this.handleNoticeMessage(result);
    },
    onRoomMessage(result) {
      this.renderChatSession(result);
      this.handleNoticeMessage(result);
    },
    onDelMessageOffline(result) {
      this.doUiAction('getChatSessionList', {type: 'onDelMessageOffline'});
    },
    // socket 置顶的通知
    onToggleChatSession(result) {
      const nowIndex = this.chatListBackUps.findIndex(v => {
        return v.chatId === result.chatId;
      });
      if (result.top === true || result.top === false) {
        this.chatListBackUps[nowIndex].topChatOrder = result.top
            ? window.dayjs().format('YYYY-MM-DDTHH:mm:ss.SSSZ')
            : '';
      }
      if (result.muted === true || result.muted === false) {
        this.chatListBackUps[nowIndex].muted = result.muted;
      }
      this.reFilterList();
    },
    onDeleteChatSession(result) {
      const nowIndex = this.chatList.findIndex(v => {
        return v.chatId === result.chatId;
      });
      this.chatList.splice(nowIndex, 1);
      const backIndex = this.chatListBackUps.findIndex(v => {
        return v.chatId === result.chatId;
      });
      this.chatListBackUps.splice(backIndex, 1);
    },

    // 更新左侧列表的聊天内容和顺序
    renderChatSession(params) {
      // 撤回消息，不是撤回的最后一条消息，不用渲染左侧列表
      const isRevokeButNotIsLastMessage =
          params.messageStatus === 'revoke' &&
          dayjs(this.currentChatSession.messageTimeString).valueOf() > dayjs(params.messageTimeString).valueOf();
      if (isRevokeButNotIsLastMessage) return false;

      // 收到消息后需要更新一下 chatList 中的数据
      this.$refs.leftPanel && this.$refs.leftPanel.updateChatListItem(params);

      // 消息在左侧列表，并且不是正在聊天中，更新左侧列表对应消息，上下下线的通知不渲染
      if (params.noticeType !== 'errorNotice') {
        if (this.isExistInChatSession(params)) {
          // 重排后再更新会话显示，否则会有取不到会话的情况
          this.reFilterList();
          // 未读+1，如果是自己发的，就不需要 +1
          if (params.fromUserId !== this.userInfo.userId) {
            this.chatListBackUps = this.chatListBackUps.map(v => {
              const findSessionByParams = v.chatId === this.getDataId(params);
              if (findSessionByParams) {
                v.offlineMessageCount += 1;
              }
              return v;
            });
          }

          this.$nextTick(() => {
            if (
                window.$vueComponent.leftPanel.$refs['chatWidget_' + this.getDataId(params)] &&
                window.$vueComponent.leftPanel.$refs['chatWidget_' + this.getDataId(params)].length
            ) {
              window.$vueComponent.leftPanel.$refs[
              'chatWidget_' + this.getDataId(params)
                  ][0].reRenderSessionBySocketMessage(params);
            }
          });
        } else {
          // 消息不带头像，需要更新聊天会话列表，避免没头像
          this.doUiAction('getChatSessionList', {type: '消息不带头像，需要更新聊天会话列表，避免没头像'});
        }
      }

      // 渲染聊天内容
      if (this.getDataId(params) === this.currentChatSessionId) {
        this.$refs.middlePanel && this.$refs.middlePanel.getChattingPage().refreshMessage(params);
        this.$forceUpdate();
      }
      return null;
    },
    renderNoticeUI(params) {
      if (this.isMsgMuted(params)) {
        return;
      }
      // 渲染好友变动
      if (params.hasOwnProperty('noticeType')) {
        if (
            params.noticeType === 'errorNotice' &&
            params.errorCode === 'chat_not_user_friend'
        ) {
          this.$refs.middlePanel
              .getChattingPage()
              .refreshMessage({
                ...params.errorReasonSupplement,
                loading: false,
                error: true
              });
          this.$forceUpdate();
        }
      }
    },

    pushState({path}) {
      if (location.search.includes(path)) {
        history.replaceState({}, '', `?${path}=${Date.now()}`);
      } else {
        history.pushState({}, '', `?${path}=${Date.now()}`);
      }
      historyNowPage = location.search;
    },

    getDataName(item) {
      if (item) {
        if (item.hasOwnProperty('messageType')) {
          return item.chatName;
        }
        return item.roomName || item.friendUsername;
      }
      return null;
    },
    /**
     * 获取发送消息socket actionID
     * @param forwardType
     */
    getSendMsgActionId(forwardType = 0) {
      if (forwardType === 1) return 'userSendMessageToRoom';
      else if (forwardType === 2) return 'userSendMessageToUser';
      return this.isRoom
          ? 'userSendMessageToRoom'
          : 'userSendMessageToUser';
    },
    /**
     * 判断消息是否在聊天列表中
     * @param params
     */
    isExistInChatSession(params) {
      const dataId = this.getDataId(params);
      return this.chatList.some(v => this.getDataId(v) === dataId);
    },

    /** 播放消息提示音 **/
    async playBeep() {
      if (!isApp) {
        try {
          await didaAudio.play();
        } catch (e) {
          if (await window.confirmDialog({
            title: '您的网页无法自动播放消息提示音，需要确认后播放',
            titleClass: 'text-body-1'
          })) {
            this.playBeepConfirm();
          }
        }
      }
    },

    /** 确认消息提示音 */
    playBeepConfirm() {
      if (!isApp) {
        didaAudio.play();
      }
    },

    /**
     * 通知处理
     * @param params
     */
    handleNoticeMessage(params) {
      const isNowRoom = this.currentChatSessionId === params.toRoomId;
      if (params.noticeType && params.noticeType === 'refreshRoomNotice') {
        // 只更新群直播间的公告信息
        console.log('只更新群直播间的公告信息');
        if (isNowRoom) {
          this.doUiAction('getRoomInfo', {justGetRoomSliderShow: true})
        }
        return;
      }
      if (this.isMsgMuted(params)) {
        return;
      }
      if (params.noticeType) {
        // 通知类，有内容
        const isNotEmptyContent = !!params.messageContent;
        const excludeNoticeType = ['onlineNotice', 'offlineNotice'];
        if (isNotEmptyContent && params.messageType === 'room') {
          // TODO: update room panel info
          if (params.noticeType === 'setRoomInfo') {
            this.chatListBackUps.find(item => {
              if (item.chatId === params.toRoomId) {
                item.chatName = params.toRoomName;
              }
              return item.chatId === params.toRoomId;
            })
            this.userRoomRoleList.find(item => {
              if (item.roomId === params.toRoomId) {
                item.roomName = params.toRoomName;
              }
              return item.roomId === params.toRoomId;
            })
            this.userRoomRoleListBackUps.find(item => {
              if (item.roomId === params.toRoomId) {
                item.roomName = params.toRoomName;
              }
              return item.roomId === params.toRoomId;
            })
            this.$refs.rightPanel && this.$refs.rightPanel.roomInfoChange(params.toRoomId);
          }
        }
        if (isNotEmptyContent) {
          // excludeNoticeType includes params.noticeType
          if (excludeNoticeType.includes(params.noticeType)) {
            // 用户上下线状态改变
            this.myFriendListBackUps.some(friend => {
              const isMessageUser = friend.friendId === params.fromUserId;
              if (isMessageUser) {
                friend.isOnline = params.noticeType === 'onlineNotice';
              }
              return isMessageUser;
            });
            return;
          }
          window.vtoast.showAndNotify({
            message: getMessageContent(params),
            title: '通知'
          });
          if (!this.$refs.leftPanel.isMuted) {
            this.playBeep();
          }
        }
        return;
      }
      // 消息类，不是自己发送的消息, 不是通知类消息
      if (params.fromUserId !== this.userInfo.userId) {
        window.vtoast.showAndNotify({
          message: `【您有一条新消息】${params.fromUsername
          }："${getMessageContent(params, true)}"`,
          title: '新消息'
        });
        if (!this.$refs.leftPanel.isMuted) {
          this.playBeep();
        }
      }
    },

    /**
     * 消息所谓会话是否设置了免打扰
     * @param msg
     */
    isMsgMuted(msg) {
      if (!msg.toRoomId && msg.fromUserId === this.userInfo.userId) {
        return false;
      }
      const chatId = msg.toRoomId || msg.fromUserId;

      const chatSession = this.chatListBackUps.find(
          chat => chat.chatId === chatId
      );
      if (!chatSession) {
        return false;
      }
      return chatSession.muted;
    }
  }
});
</script>
<style>
.v-snack--top {
  top: 60px !important;
}

.navigation-drawer .v-navigation-drawer__content {
  display: flex;
  flex-direction: column;
}


.chatMain {
  box-sizing: border-box;
  height: 100vh;
  background: #f5f7fa;
}

.navigation-drawer {
  max-height: 100vh !important;
  overflow: hidden !important;
}


.vFooter .chatToolbar {
  height: 50px !important;
  flex: 1;
}

.vFooter .chatToolbar .v-toolbar__content {
  height: 50px !important;
}

.v-navigation-drawer__content {
  overflow: hidden !important;

}

.text-body-2 {
  width: 100%;
  height: 100%;
}

.text-body-2 .v-input {
  font-size: 14px;
}

.text-body-2 .v-text-field {
  border: 2px solid #ffffff;
  border-radius: 4px;
}

.text-body-2 .v-text-field.error--text {
  border: 2px solid #ff5252;
  border-radius: 4px;
}

.leftDataListItemEmpty {
  align-items: stretch;
}

.leftDataListItemEmpty .empty_chatInfos {
  flex: 1;
  flex-flow: column;
  align-items: flex-start;
}

.leftDataListItemEmpty .empty_message {
  flex: 1;
  width: 90%;
  max-height: 14px;
  background: #EEEEEE;
}

.leftDataListItemEmpty .empty_title {
  flex: 1;
  width: 50%;
  max-height: 14px;
  background: #EEEEEE;
}

.leftDataListItemEmpty .empty_avatar {
  width: 40px;
  height: 40px;
  background: #EEEEEE;
  border-radius: 20px;
}


.fileInput {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
  top: -10000px;
}

.footer {
  width: 100%;
  border-top: 1px solid #cccccc;
  height: 100%;
  background-color: #fff;
}

.v-input__slot::before,
.v-input__slot::after {
  content: none !important;
}

.userInfoCard {
  box-shadow: none !important;

  position: relative;
}

.nickname {
  font-size: 14px;
  line-height: 1.5rem
}

.whatUp {
  font-size: 12px;
  white-space: nowrap
}

.controlBox {
  width: 100%;
  height: 30px;
  border-bottom: 1px solid #EEEEEE;
  display: flex;
  align-items: center;
  font-size: 12px;
  justify-content: space-between;
  color: #999999;

}

.controlBox span {
  color: red;
}

.leftDataList .v-item-group .listItem {
  position: absolute;
  left: 0;
  right: 0;
  height: 70px;
}

.leftDataList {
  overflow-y: scroll;
  overflow-x: hidden;
  flex: 1;
  -webkit-overflow-scrolling: touch;
}

.leftDataList::-webkit-scrollbar {
  width: 5px;
}

.leftDataList::-webkit-scrollbar-track {
  width: 5px;
  background-color: #F1F1F1;
}

.leftDataList::-webkit-scrollbar-thumb {
  width: 3px;
  background-color: #E1E1E1;
  border-radius: 3px;
}

.leftDataList .activeItem .chatItem {
  background-color: < $ ctx . app . config . primaryColorA80 $ > !important;
}

.leftDataList .activeItem {
  background-color: #ffffff !important;
  position: relative;
  overflow: hidden;
}

.leftDataList .isTopChat {
  overflow: hidden;
}

.leftDataList .isTopChat::after {
  content: "";
  position: absolute;
  width: 20px;
  height: 20px;
  transform: rotate(-45deg) translate(-2px, -16px);
  min-height: 0;
  left: 0;
  top: 0;
  z-index: 999999;
  background-color: #B71C1C;
}

.searchKeyword .v-label {
  color: #cccccc;
  font-size: 12px;
}

.message {
  position: relative;
  overflow: hidden;
  border-radius: 5px;
  background: #FFFFFF;
  font-size: 14px;
  padding: 10px;
  align-content: start;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
}

.message .progress {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 2;
}

.newFriendBtn {
  margin: 10px;
  width: calc(100% - 20px);
  min-width: auto !important;
}

.flex-row-around {
  flex-direction: row;
  justify-content: space-around;
  align-items: center;
}


.contSelect {
  -moz-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}

.startRecord {
  background: green;
  animation: startRecordAnim 0.5s infinite;
  animation-direction: alternate;
}

.v-badge__badge {
  z-index: 3;
}

@keyframes startRecordAnim {
  from {
    background: transparent;
    color: #666666
  }

  to {
    background: green;
    color: #FFFFFF
  }
}

@-webkit-keyframes startRecordAnim

  /*Safari and Chrome*/
{
  from {
    background: transparent;
    color: #666666
  }

  to {
    background: green;
    color: #FFFFFF
  }
}

.playIcon::before {
  content: "\F1591";
  display: inline-block;
  font: normal normal normal 24px/1 "Material Design Icons";
  font-size: 18px;
  text-rendering: auto;
  line-height: inherit;
  -webkit-font-smoothing: antialiased;
  color: green;
  transform: translate(5px, 2px);
}

.moreSelToolbar {
  flex-direction: row !important;
  font-size: 14px;
  width: 100%;
}

.moreSelToolbar button {
  flex: 1;
}

.moreSelToolbarMob {
  padding-bottom: 0px;
}

.mob-app-bar-nav-icon {
  display: none;
}

.mob-app-bar-basic-info {
  display: none;
}

.mob-app-bar-basic-title {
  color: #FFFFFF;
  font-size: 14px;
  font-weight: 500;
  width: 100%;
}

.mob-app-bar-basic-info-back {
  display: none;
}

.stopUserSelect {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
}

@media screen and (max-width: 600px) {
  .sendMsgEmoji {
    right: 72px;
    bottom: 8px;
  }

  .leftDataList {
    height: calc(100vh - 180px) !important;
    -webkit-overflow-scrolling: touch;
    overflow-scrolling: touch;
  }

  .mob-app-left {
    width: 100% !important;
  }

  .mob_nickname {
    display: block !important;
  }

  .pc_nickname {
    display: none;
  }

  .mobExpandChat .emotionContainer {
    bottom: 68px !important
  }

  .emotionContainer {
    width: 100% !important;
    bottom: 59px !important;
    height: 223px !important;
  }

  .mobExpandChat .emotionContainer .arrow {
    right: 58px !important;
  }

  .emotionContainer .arrow {
    left: auto !important;
    right: 42px !important;
  }

  .fileContent {
    max-width: 230px !important;
    overflow: hidden !important;
  }

  .fileContentFileDesc {
    display: inline-block !important;
    font-size: 12px !important;
  }

  .mob-app-footer {
  }

  .mob-app-left--hide {
    display: none;
  }

  .mob-app-main {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  .mob-app-bar {
    left: 0 !important;
    right: 0 !important;
  }

  .mob-app-footer {
    left: 0 !important;
    right: 0 !important;
  }

  .mob-app-bar-nav-icon {
    display: block;
  }

  .mob-app-right--hide {
    display: none;
  }

  .mob-app-bar-basic-info {
    display: block;
    font-size: 14px !important;
    font-weight: 500;
  }

  .mob-app-bar-basic-info-back {
    display: block;
  }

  .emotionContainer {
    left: auto !important;
  }

  .v-overlay--active {
  }

  .v-dialog__content--active {
  }

  .footer {
    border: 0 !important;
  }

  .text-body-2 textarea::-webkit-scrollbar,
  .text-body-2 textarea::-webkit-scrollbar-track,
  .text-body-2 textarea::-webkit-scrollbar-thumb {
    width: 0 !important;
  }

  .text-body-2 textarea {
    padding: 7px 5px 0 !important;
    height: 70px !important;
    line-height: 1.6 !important;
    overflow: auto !important;
  }

  .text-body-2 .v-text-field {
    max-height: 100%;
  }

  .v-input--dense > .v-input__control > .v-input__slot {
    margin-bottom: 0 !important;
  }

  .v-application .v-input {
    font-size: 12px !important;
  }

  .v-application .text-body-2 {
    border: 1px solid #EEEEEE !important;
    border-radius: 4px !important;
    overflow: hidden !important;
    padding: 0 !important;
    margin: 0 !important;
    font-size: 12px !important;
  }

  .v-application .error--text .theme--light.v-counter {
    transform: translateX(-3px);
  }

  .v-application .error--text .v-messages__message {
    zoom: 0.9;
    transform: translateX(5px);
  }

  .searchAndNewFriendBox .v-text-field {
    flex: 1;
  }

  .newFriendBtn {
    min-width: 0 !important;
    width: auto !important;
    max-width: 100px !important;
    letter-spacing: 0 !important;
    padding: 0 0 0 5px !important;
  }

  .searchAndNewFriendBox {
    display: flex;
    align-items: center;
  }

  .recordBtn {
    flex: 1 !important;
    border: 1px solid #cccccc !important;
    padding: 6px 4px !important;
    border-radius: 4px !important;
    text-align: center !important;
    font-size: 14px !important;
    color: #666666 !important;
  }

  .recordSheet {
    height: 90vh !important;
    background: transparent !important;
  }

  .cancelSendAudioArea span {
    height: 50px;
    text-align: center;
    color: #ffffff;
    transition: all .2s linear;
    border-radius: 100%;
    line-height: 50px;
    display: block;
    margin: 40px auto;
  }

  .cancelSendAudioArea .recordAnim {
    flex: 1;
    background: url("app/public/img/play.gif") no-repeat bottom;
  }

  .cancelSendAudioArea.recordSendStatus span {
    color: red;
    font-size: 18px;
    font-weight: bold;
  }

  .cancelSendAudioArea {
    flex: 1;
    display: flex;
    flex-flow: column;
  }

  .canSendAudioArea.recordSendStatus span {
    color: #32d300;
  }

  .canSendAudioArea span {
    color: #cccccc;
    transition: all .2s linear;
  }

  .canSendAudioArea {
    height: 50px;
    background: #ffffff;
    border-top-left-radius: 100%;
    border-top-right-radius: 100%;
    padding-bottom: 100px;
    width: 120vw;
    transform: translateX(-10vw);
    text-align: center;
    line-height: 100px;
    font-weight: 400;
    font-size: 16px;
    color: #999999;
  }

  .newMsgCount {
    bottom: 139px !important;
  }


}
</style>
{% endblock %}
